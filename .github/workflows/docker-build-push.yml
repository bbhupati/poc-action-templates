  on:
    workflow_call:

  # docker-build-push.yml
  jobs:

    job1:
      uses: bbhupati/poc-action-templates/.github/workflows/set-env.yml@master

    docker-build-push:
      runs-on: ubuntu-latest
      needs: job1
      steps:
        - name: Checkout code
          uses: actions/checkout@v2
          
        - name: Read environment file and set environment variables
          run: |
            echo "env is ${{ needs.job1.outputs.environment }}"
            ENV_FILE=".github/workflows/${{ needs.job1.outputs.environment }}-vars.env"
            cat $ENV_FILE >> $GITHUB_ENV
            echo "Loaded $ENV_FILE into environment variables"

        - name: Docker Build and Push
          run: |
            CONTAINER_IMAGE_NAME=$ACR_REGISTRY/$IMAGE_NAME:${{ github.run_id }}
    
            # Docker Log in to Azure Container Registry (ACR)
            echo "docker login -u $ACR_USERNAME -p ${{ secrets.ACR_PASSWORD }} $ACR_REGISTRY"
    
            # Build the Docker image
            echo "docker build -t $CONTAINER_IMAGE_NAME ."
    
            # Push Docker Image to ACR
            echo "docker push $CONTAINER_IMAGE_NAME"

            echo "successfully pushed $CONTAINER_IMAGE_NAME"

  
  # jobs:
  #   job1:
  #     uses: bbhupati/poc-action-templates/.github/workflows/set-env.yml@master
  
  #   job2:
  #     runs-on: ubuntu-latest
  #     needs: job1
  #     steps:
  #       - run: echo ${{ needs.job1.outputs.environment }}
  